<!DOCTYPE HTML>
<html lang="pt-br" xlmns:th:="http://www.thymeleaf.org">

<head>
<meta charset="utf-8">
<title>BuiaTchaKa Games</title>
<link rel="stylesheet" th:href="@{/css/reset.css}">
<link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
<link rel="stylesheet" th:href="@{/css/font-awesome.min.css}">
<link rel="stylesheet"
	href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"
	integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU"
	crossorigin="anonymous">
</head>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
<body>
	<div class="container-fluid p-0">
		<header>
			<div class="container-fluid p-1 border border-dark">
				BuiaTchaKa Games | Dashboard <br>
			</div>
			<div class="container-fluid bg-light"></div>
		</header>
		<div class="container-fluid pl-0">
			<div class="row mt-4">
				<div class="col-md-2">
					<div class="p-0 bg-light">
						<h6 th:text="${session?.admin?.nome}"></h6>
						<h6 th:text="${session?.admin?.email}"></h6>
						<nav class="navbar bg-light">
							<ul class="navbar-nav">
								<li class="nav-item font-weight-bold"><a class="nav-link"
									href="#">Início</a></li>
								<li class="nav-item"><a class="nav-link"
									href="admin/perfil">Perfil</a></li>
								<li class="nav-item"><a class="nav-link"
									href="admin/produtos">Produtos</a></li>
								<li class="nav-item"><a class="nav-link"
									href="admin/estoque">Estoque</a></li>
								<li class="nav-item"><a class="nav-link"
									href="admin/clientes">Clientes</a></li>
								<li class="nav-item"><a class="nav-link"
									href="admin/pedidos">Pedidos</a></li>
								<li class="nav-item"><a class="nav-link"
									href="admin/trocas">Trocas</a></li>
								<li class="nav-item"><a class="nav-link"
									href="admin/cupons">Cupons</a></li>
								<li class="nav-item"><a class="nav-link"
									href="admin/usuarios">Usuários</a></li>
								<li class="nav-item"><a class="nav-link" href="admin/logs">Logs</a>
								</li>
							</ul>
						</nav>
					</div>
				</div>
				<div class="col">
					<h3>Gráficos:</h3>
					<h6>Produtos vendidos por categoria no período: </h6>
					<input type="hidden" th:value="${dataInicio}" name="dataInicio" id="dataInicio">
					<input type="hidden" th:value="${dataFim}" name="dataFim" id="dataFim">
					<canvas id="myChart"></canvas>
				</div>
				<div class="col">Ações recentes</div>
			</div>
			<footer> Footer </footer>
		</div>
</body>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
<script>
	function grab() {
	    /* Promise to make sure data loads */
	    console.log(document.getElementById('dataInicio').value);
	    return new Promise((resolve, reject) => {
	        $.ajax({
	            url: "/admin/api/analise/" + document.getElementById('dataInicio').value + "/" + document.getElementById('dataFim').value,
	            method: "GET",
	            dataType: 'JSON',
	            success: function(data) {
	                resolve(data)
	            },
	            error: function(error) {
	                reject(error);
	            }
	        })
	    })
	}
	
	$(document).ready(function() {
        grab().then((data) => {
            console.log('Recieved our data', data);
            let meses = [];
            let value = [];
			let categorias = [];
            try {
                data.forEach((item) => {
                	if (!meses.includes(item[1])){
                    	meses.push(item[1]);
                	}
                    value.push(item[0])
                    categorias.push(item[2])
                });
				
                let chartdata = {
                    labels: [...meses],
                    datasets: []
//             {
//                             label: [...categorias],
//                             backgroundColor: 'rgba(200, 200, 200, 0.75)',
//                             borderColor: 'rgba(200, 200, 200, 0.75)',
//                             hoverBackgroundColor: 'rgba(200, 200, 200, 1)',
//                             hoverBorderColor: 'rgba(200, 200, 200, 1)',
//                             data: [...value]
//                         }
                };
                
             // adicionar um dataset para cada array
                data.forEach((i) => {
                	var dataset = {
		                    label: [i[2]],
		                    backgroundColor: 'rgba(' + Math.floor(Math.random() * 101) + 
		                    		',' + Math.floor(Math.random() * 101) + 
		                    		',' + Math.floor(Math.random() * 101) + ', 1)',
		                    borderColor: 'rgba(200, 200, 200, 0.75)',
		                    data: [i[0]]
		                };
		                chartdata.datasets.push(dataset);
                })
		                

                let ctx = $("#myChart");

                let barGraph = new Chart(ctx, {
                    type: 'bar',
                    data: chartdata,
                    options: {
                        scales: {
                            yAxes: [{
                                ticks: {
                                    beginAtZero: true,
                                    stepSize: 1,
                                    suggestedMax: 5
                                }
                            }]
                        }
                    }
                });

            } catch (error) {
                console.log('Error parsing JSON data', error)
            }

        }).catch((error) => {
            console.log(error);
        })
    });
	
	
</script>

<script th:src="@{../../js/jquery.min.js}"></script>
<script th:src="@{../../js/popper.min.js}"></script>
<script th:src="@{../../js/bootstrap.min.js}"></script>
</html>